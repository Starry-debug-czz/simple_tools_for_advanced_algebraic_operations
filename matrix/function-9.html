<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quadratic Form Standard Form - Linear Algebra Code World</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Exo+2:wght@300;400;600&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --neon-blue: #00CCFF;
            --neon-purple: #6C00FF;
            --fluorescent-green: #00FFC6;
            --deep-space: #0A0A14;
            --holographic-silver: #C0C0C0;
            --neon-red: #FF0066;
            --electric-blue: #0099FF;
        }
        
        body {
            font-family: 'Exo 2', sans-serif;
            background: var(--deep-space);
            overflow-x: hidden;
        }
        
        .orbitron {
            font-family: 'Orbitron', monospace;
        }
        
        .cosmic-bg {
            background: linear-gradient(135deg, var(--deep-space) 0%, #1a1a2e 50%, #16213e 100%);
            position: relative;
        }
        
        .holographic-grid {
            background-image: 
                linear-gradient(rgba(0, 204, 255, 0.1) 1px, transparent 1px),
                linear-gradient(90deg, rgba(0, 204, 255, 0.1) 1px, transparent 1px);
            background-size: 50px 50px;
            animation: gridMove 20s linear infinite;
        }
        
        @keyframes gridMove {
            0% { background-position: 0 0; }
            100% { background-position: 50px 50px; }
        }
        
        .nav-blur {
            backdrop-filter: blur(20px);
            background: rgba(10, 10, 20, 0.8);
        }
        
        .code-container {
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(0, 204, 255, 0.3);
            border-radius: 10px;
            max-height: 600px;
            overflow-y: auto;
        }
        
        .input-container {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
        }
        
        .matrix-input {
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(0, 204, 255, 0.3);
            color: white;
            font-family: 'Courier New', monospace;
            resize: vertical;
        }
        
        .matrix-input:focus {
            border-color: var(--neon-blue);
            box-shadow: 0 0 10px rgba(0, 204, 255, 0.3);
            outline: none;
        }
        
        .matrix-input.error {
            border-color: var(--neon-red);
            box-shadow: 0 0 10px rgba(255, 0, 102, 0.3);
            animation: shake 0.5s ease-in-out;
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
        
        .result-container {
            background: rgba(0, 255, 198, 0.1);
            border: 1px solid rgba(0, 255, 198, 0.3);
            border-radius: 10px;
            animation: glow 2s ease-in-out infinite alternate;
        }
        
        @keyframes glow {
            from { box-shadow: 0 0 10px rgba(0, 255, 198, 0.3); }
            to { box-shadow: 0 0 20px rgba(0, 255, 198, 0.6); }
        }
        
        .liquid-metal {
            background: linear-gradient(45deg, #2a2a3e, #3a3a4e, #2a2a3e);
            background-size: 400% 400%;
            animation: liquidFlow 8s ease-in-out infinite;
        }
        
        @keyframes liquidFlow {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }
        
        .electromagnetic-pulse {
            position: relative;
            overflow: hidden;
        }
        
        .electromagnetic-pulse::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: radial-gradient(circle, var(--fluorescent-green), transparent);
            transform: translate(-50%, -50%);
            transition: all 0.6s ease;
            border-radius: 50%;
        }
        
        .electromagnetic-pulse:hover::before {
            width: 300px;
            height: 300px;
        }
        
        .particle-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
        }
        
        .particle {
            position: absolute;
            width: 2px;
            height: 2px;
            background: var(--neon-blue);
            border-radius: 50%;
            animation: float 6s ease-in-out infinite;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px) rotate(0deg); opacity: 0; }
            50% { transform: translateY(-100px) rotate(180deg); opacity: 1; }
        }
        
        .syntax-highlight .keyword { color: #ff79c6; }
        .syntax-highlight .type { color: #8be9fd; }
        .syntax-highlight .function { color: #50fa7b; }
        .syntax-highlight .comment { color: #6272a4; }
        .syntax-highlight .string { color: #f1fa8c; }
        .syntax-highlight .number { color: #bd93f9; }
        
        .breadcrumb {
            color: var(--holographic-silver);
            font-size: 14px;
        }
        
        .breadcrumb .current {
            color: var(--neon-blue);
        }
        
        .option-button {
            background: rgba(0, 204, 255, 0.1);
            border: 1px solid rgba(0, 204, 255, 0.3);
            color: var(--neon-blue);
            transition: all 0.3s ease;
        }
        
        .option-button:hover {
            background: rgba(0, 204, 255, 0.2);
            box-shadow: 0 0 15px rgba(0, 204, 255, 0.4);
        }
        
        .process-step {
            background: rgba(255, 255, 255, 0.05);
            border-left: 3px solid var(--fluorescent-green);
            margin-bottom: 15px;
            padding: 15px;
            border-radius: 5px;
        }
        
        .process-step.highlight {
            background: rgba(0, 255, 198, 0.1);
            border-left-color: var(--fluorescent-green);
            box-shadow: 0 0 10px rgba(0, 255, 198, 0.2);
        }
        
        /* 新增样式：中英双行文 */
        .bilingual {
            line-height: 1.6;
        }
        
        .bilingual .en {
            color: var(--holographic-silver);
            font-size: 0.9em;
        }
        
        .bilingual .zh {
            color: white;
            font-size: 1em;
        }
        
        /* 新增样式：矩阵显示 */
        .matrix-display {
            display: inline-block;
            padding: 10px;
            margin: 5px 0;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 5px;
            border: 1px solid rgba(0, 204, 255, 0.2);
        }
        
        .matrix-row {
            display: flex;
            justify-content: center;
        }
        
        .matrix-cell {
            padding: 5px 10px;
            text-align: center;
            min-width: 40px;
            font-family: 'Courier New', monospace;
            color: white;
        }
        
        .matrix-bracket {
            font-size: 1.5em;
            font-weight: bold;
            padding: 0 5px;
            display: flex;
            align-items: center;
        }
        
        .calculation-step {
            margin: 10px 0;
            padding: 10px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 5px;
        }
        
        .step-number {
            color: var(--neon-blue);
            font-weight: bold;
        }
        
        .standard-form {
            font-size: 1.2em;
            padding: 15px;
            background: rgba(0, 255, 198, 0.1);
            border-radius: 10px;
            margin: 10px 0;
            text-align: center;
            color: var(--fluorescent-green);
        }
        
        .transformation-matrix {
            background: rgba(108, 0, 255, 0.1);
            border: 1px solid rgba(108, 0, 255, 0.3);
            border-radius: 10px;
            padding: 15px;
            margin: 10px 0;
        }
        
        .verification-section {
            background: rgba(0, 153, 255, 0.1);
            border: 1px solid rgba(0, 153, 255, 0.3);
            border-radius: 10px;
            padding: 15px;
            margin: 10px 0;
        }
        
        .error-analysis {
            background: rgba(255, 0, 102, 0.1);
            border: 1px solid rgba(255, 0, 102, 0.3);
            border-radius: 10px;
            padding: 15px;
            margin: 10px 0;
        }
        
        .augmented-matrix {
            background: rgba(255, 165, 0, 0.1);
            border: 1px solid rgba(255, 165, 0, 0.3);
            border-radius: 10px;
            padding: 15px;
            margin: 10px 0;
        }
    </style>
</head>
<body class="cosmic-bg min-h-screen">
    <!-- Particle Background -->
    <div class="particle-container" id="particles"></div>
    
    <!-- Holographic Grid -->
    <div class="holographic-grid fixed inset-0 opacity-30"></div>
    
    <!-- Navigation -->
    <nav class="fixed top-0 w-full z-50 nav-blur border-b border-opacity-20 border-blue-400">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="orbitron text-xl font-bold text-blue-400">
                    <div class="bilingual">
                        <div class="zh">二次型标准型</div>
                        <div class="en">Quadratic Form Standard</div>
                    </div>
                </div>
                <div class="flex items-center space-x-6">
                    <div class="breadcrumb">
                        <a href="index.html" class="hover:text-blue-400">Home</a> → 
                        <a href="directory.html" class="hover:text-blue-400">Directory</a> → 
                        <span class="current">
                            <div class="bilingual">
                                <div class="zh">二次型标准型</div>
                                <div class="en">Quadratic Form Standard</div>
                            </div>
                        </span>
                    </div>
                    <button class="px-6 py-2 liquid-metal text-white rounded-full electromagnetic-pulse" onclick="window.location.href='directory.html'">
                        <div class="bilingual">
                            <div class="zh">← 目录</div>
                            <div class="en">← Directory</div>
                        </div>
                    </button>
                </div>
            </div>
        </div>
    </nav>
    
    <!-- Main Content -->
    <main class="pt-24 pb-16">
        <div class="container mx-auto px-6">
            <!-- Header -->
            <div class="text-center mb-12">
                <h1 class="orbitron text-5xl md:text-6xl font-black mb-6">
                    <span class="bg-gradient-to-r from-blue-400 to-purple-600 bg-clip-text text-transparent">
                        <div class="bilingual">
                            <div class="zh">二次型</div>
                            <div class="en">Quadratic Form</div>
                        </div>
                    </span>
                    <span class="bg-gradient-to-r from-green-400 to-blue-400 bg-clip-text text-transparent">
                        <div class="bilingual">
                            <div class="zh">标准型</div>
                            <div class="en">Standard Form</div>
                        </div>
                    </span>
                </h1>
                <p class="text-xl text-gray-300 max-w-3xl mx-auto bilingual">
                    <span class="zh">通过增广矩阵法将对称矩阵化为标准型，包含完整的变换过程可视化和误差分析。</span>
                    <span class="en">Transform symmetric matrices to standard form through augmented matrix method, with complete process visualization and error analysis.</span>
                </p>
            </div>
            
            <!-- Main Layout -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 max-w-7xl mx-auto">
                <!-- Code Display Section -->
                <div class="space-y-6">
                    <div class="code-container p-6">
                        <h3 class="orbitron text-xl font-bold mb-4 text-blue-400 bilingual">
                            <div class="zh">核心实现</div>
                            <div class="en">Core Implementation</div>
                        </h3>
                        <pre class="text-sm text-gray-300 overflow-x-auto"><code class="syntax-highlight">
<span class="keyword">void</span> <span class="function">quadraticFormByAugmentedMatrix</span>() {
    <span class="comment">// 输入对称矩阵</span>
    <span class="type">int</span> n;
    cout << <span class="string">"输入变量个数: "</span>; cin >> n;
    <span class="keyword">auto</span> A = inputMatrix(n, n);
    
    <span class="comment">// 构建增广矩阵 [A | I]</span>
    vector&lt;vector&lt;double&gt;&gt; aug(n, vector&lt;double&gt;(2*n, 0));
    <span class="keyword">for</span> (<span class="type">int</span> i = 0; i < n; i++) {
        <span class="keyword">for</span> (<span class="type">int</span> j = 0; j < n; j++) aug[i][j] = A[i][j];
        aug[i][n+i] = 1;
    }
    
    <span class="comment">// 合同变换过程</span>
    <span class="keyword">for</span> (<span class="type">int</span> i = 0; i < n; i++) {
        <span class="comment">// 寻找主元</span>
        <span class="type">int</span> pivot = i;
        <span class="keyword">for</span> (<span class="type">int</span> j = i+1; j < n; j++) {
            <span class="keyword">if</span> (fabs(aug[j][j]) > fabs(aug[pivot][pivot])) {
                pivot = j;
            }
        }
        
        <span class="keyword">if</span> (fabs(aug[pivot][pivot]) < 1e-10) {
            <span class="comment">// 处理零对角元情况</span>
            <span class="type">bool</span> found = <span class="keyword">false</span>;
            <span class="keyword">for</span> (<span class="type">int</span> j = i+1; j < n && !found; j++) {
                <span class="keyword">if</span> (fabs(aug[i][j]) > 1e-10) {
                    <span class="comment">// 构造创造平方项的变换矩阵</span>
                    vector&lt;vector&lt;double&gt;&gt; T(n, vector&lt;double&gt;(n, 0));
                    <span class="keyword">for</span> (<span class="type">int</span> k = 0; k < n; k++) T[k][k] = 1;
                    T[i][i] = 1;
                    T[i][j] = 1;
                    T[j][i] = 1;
                    T[j][j] = -1;
                    
                    <span class="comment">// 应用合同变换到整个增广矩阵</span>
                    <span class="keyword">auto</span> TT = transpose(T);
                    vector&lt;vector&lt;double&gt;&gt; tempA(n, vector&lt;double&gt;(n, 0));
                    vector&lt;vector&lt;double&gt;&gt; tempI(n, vector&lt;double&gt;(n, 0));
                    
                    <span class="keyword">for</span> (<span class="type">int</span> r = 0; r < n; r++) {
                        <span class="keyword">for</span> (<span class="type">int</span> c = 0; c < n; c++) {
                            tempA[r][c] = aug[r][c];
                            tempI[r][c] = aug[r][n+c];
                        }
                    }
                    
                    tempA = matrixMultiply(matrixMultiply(TT, tempA), T);
                    tempI = matrixMultiply(tempI, T);
                    
                    <span class="keyword">for</span> (<span class="type">int</span> r = 0; r < n; r++) {
                        <span class="keyword">for</span> (<span class="type">int</span> c = 0; c < n; c++) {
                            aug[r][c] = tempA[r][c];
                            aug[r][n+c] = tempI[r][c];
                        }
                    }
                    
                    found = <span class="keyword">true</span>;
                    i--; <span class="comment">// 重新处理这一行</span>
                    <span class="keyword">break</span>;
                }
            }
        } <span class="keyword">else</span> {
            <span class="keyword">if</span> (pivot != i) {
                <span class="comment">// 行交换和列交换</span>
                swap(aug[i], aug[pivot]);
                <span class="keyword">for</span> (<span class="type">int</span> j = 0; j < n; j++) {
                    swap(aug[j][i], aug[j][pivot]);
                    swap(aug[j][n+i], aug[j][n+pivot]);
                }
            }
            
            <span class="comment">// 消去其他行的对应元素（同时进行行变换和列变换）</span>
            <span class="keyword">for</span> (<span class="type">int</span> j = 0; j < n; j++) {
                <span class="keyword">if</span> (j != i && fabs(aug[j][i]) > 1e-10) {
                    <span class="type">double</span> factor = aug[j][i] / aug[i][i];
                    
                    <span class="comment">// 行消去</span>
                    <span class="keyword">for</span> (<span class="type">int</span> k = i; k < 2*n; k++) {
                        aug[j][k] -= factor * aug[i][k];
                    }
                    
                    <span class="comment">// 列消去（保持对称性）</span>
                    <span class="keyword">for</span> (<span class="type">int</span> k = 0; k < n; k++) {
                        aug[k][j] -= factor * aug[k][i];
                    }
                }
            }
        }
    }
    
    <span class="comment">// 提取结果</span>
    vector&lt;double&gt; coeffs(n);
    vector&lt;vector&lt;double&gt;&gt; B(n, vector&lt;double&gt;(n));
    
    <span class="keyword">for</span> (<span class="type">int</span> i = 0; i < n; i++) {
        coeffs[i] = aug[i][i];
        <span class="keyword">for</span> (<span class="type">int</span> j = 0; j < n; j++) {
            B[i][j] = aug[i][n+j];
        }
    }
    
    <span class="comment">// 输出标准型和变换矩阵</span>
    cout << <span class="string">"标准型: f = "</span>;
    <span class="type">bool</span> first = <span class="keyword">true</span>;
    <span class="keyword">for</span> (<span class="type">int</span> i = 0; i < n; i++) {
        <span class="keyword">if</span> (fabs(coeffs[i]) > 1e-10) {
            <span class="keyword">if</span> (!first) cout << <span class="string">" + "</span>;
            cout << coeffs[i] << <span class="string">" * y"</span> << i+1 << <span class="string">"²"</span>;
            first = <span class="keyword">false</span>;
        }
    }
    cout << endl;
}</code></pre>
                    </div>
                    
                    <!-- Algorithm Explanation -->
                    <div class="input-container p-6">
                        <h3 class="orbitron text-xl font-bold mb-4 text-green-400 bilingual">
                            <div class="zh">算法步骤</div>
                            <div class="en">Algorithm Steps</div>
                        </h3>
                        <div class="space-y-3">
                            <div class="process-step bilingual">
                                <div class="zh"><strong>1. 输入验证：</strong>确保输入的是对称矩阵</div>
                                <div class="en"><strong>1. Input Validation:</strong> Ensure input is a symmetric matrix</div>
                            </div>
                            <div class="process-step bilingual">
                                <div class="zh"><strong>2. 构建增广矩阵：</strong>创建 [A | I] 形式的增广矩阵</div>
                                <div class="en"><strong>2. Build Augmented Matrix:</strong> Create augmented matrix in form [A | I]</div>
                            </div>
                            <div class="process-step highlight bilingual">
                                <div class="zh"><strong>3. 合同变换：</strong>通过行和列变换将A部分化为对角矩阵</div>
                                <div class="en"><strong>3. Congruence Transformation:</strong> Transform A part to diagonal matrix through row and column operations</div>
                            </div>
                            <div class="process-step bilingual">
                                <div class="zh"><strong>4. 结果提取：</strong>得到标准型系数和变换矩阵</div>
                                <div class="en"><strong>4. Result Extraction:</strong> Obtain standard form coefficients and transformation matrix</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Interactive Input Section -->
                <div class="space-y-6">
                    <div class="input-container p-6">
                        <h3 class="orbitron text-xl font-bold mb-6 text-green-400 bilingual">
                            <div class="zh">让我们解决问题</div>
                            <div class="en">Let's Solve the Problem</div>
                        </h3>
                        
                        <!-- Matrix Input -->
                        <div class="mb-6">
                            <label class="block text-blue-400 font-semibold mb-2 bilingual">
                                <div class="zh">对称矩阵 A</div>
                                <div class="en">Symmetric Matrix A</div>
                            </label>
                            <textarea 
                                id="matrixInput" 
                                class="matrix-input w-full h-32 p-3 rounded" 
                                placeholder="Enter symmetric matrix (rows separated by new lines, elements by spaces)&#10;Example:&#10;2 -1 0&#10;-1 2 -1&#10;0 -1 2"
                            ></textarea>
                            <div id="matrix-error" class="text-red-400 text-sm mt-2 hidden"></div>
                        </div>
                        
                        <!-- Calculate Button -->
                        <button 
                            id="calculateBtn" 
                            class="w-full py-3 liquid-metal text-white rounded-lg electromagnetic-pulse orbitron font-bold"
                        >
                            <div class="bilingual">
                                <div class="zh">计算标准型</div>
                                <div class="en">Calculate Standard Form</div>
                            </div>
                        </button>
                    </div>
                    
                    <!-- Results Section -->
                    <div id="resultsSection" class="hidden">
                        <div class="result-container p-6">
                            <h3 class="orbitron text-xl font-bold mb-4 text-green-400 bilingual">
                                <div class="zh">结果</div>
                                <div class="en">Result</div>
                            </h3>
                            
                            <!-- Standard Form -->
                            <div class="standard-form" id="standardForm"></div>
                            
                            <!-- Augmented Matrix -->
                            <div class="augmented-matrix">
                                <h4 class="orbitron text-lg font-bold mb-3 text-orange-400 bilingual">
                                    <div class="zh">最终增广矩阵 [对角矩阵|变换矩阵]</div>
                                    <div class="en">Final Augmented Matrix [Diagonal|Transformation]</div>
                                </h4>
                                <div id="augmentedMatrix" class="bg-black bg-opacity-50 p-4 rounded"></div>
                            </div>
                            
                            <!-- Transformation Matrix -->
                            <div class="transformation-matrix">
                                <h4 class="orbitron text-lg font-bold mb-3 text-purple-400 bilingual">
                                    <div class="zh">变换矩阵 C</div>
                                    <div class="en">Transformation Matrix C</div>
                                </h4>
                                <div id="transformMatrix" class="bg-black bg-opacity-50 p-4 rounded"></div>
                            </div>
                            
                            <!-- Verification Section -->
                            <div class="verification-section">
                                <h4 class="orbitron text-lg font-bold mb-3 text-blue-400 bilingual">
                                    <div class="zh">验证结果</div>
                                    <div class="en">Verification Results</div>
                                </h4>
                                <div id="verificationResults" class="text-sm"></div>
                            </div>
                            
                            <!-- Error Analysis -->
                            <div class="error-analysis">
                                <h4 class="orbitron text-lg font-bold mb-3 text-red-400 bilingual">
                                    <div class="zh">误差分析</div>
                                    <div class="en">Error Analysis</div>
                                </h4>
                                <div id="errorAnalysis"></div>
                            </div>
                            
                            <!-- Options -->
                            <div class="mt-6 space-y-3">
                                <h4 class="text-blue-400 font-semibold bilingual">
                                    <div class="zh">您想接下来做什么？</div>
                                    <div class="en">What would you like to do next?</div>
                                </h4>
                                <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
                                    <button id="continueBtn" class="option-button px-4 py-2 rounded text-sm bilingual">
                                        <div class="zh">继续</div>
                                        <div class="en">Continue</div>
                                    </button>
                                    <button id="directoryBtn" class="option-button px-4 py-2 rounded text-sm bilingual">
                                        <div class="zh">目录</div>
                                        <div class="en">Directory</div>
                                    </button>
                                    <button id="processBtn" class="option-button px-4 py-2 rounded text-sm bilingual">
                                        <div class="zh">查看过程</div>
                                        <div class="en">View Process</div>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Process Visualization -->
                    <div id="processSection" class="hidden">
                        <div class="input-container p-6">
                            <h3 class="orbitron text-xl font-bold mb-4 text-blue-400 bilingual">
                                <div class="zh">计算过程</div>
                                <div class="en">Calculation Process</div>
                            </h3>
                            <div id="processSteps" class="space-y-3"></div>
                            <div class="mt-4">
                                <button id="downloadBtn" class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors bilingual">
                                    <div class="zh">下载过程</div>
                                    <div class="en">Download Process</div>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>
    
    <!-- Footer -->
    <footer class="py-12 border-t border-gray-800">
        <div class="container mx-auto px-6 text-center">
            <div class="orbitron text-lg text-blue-400 mb-4 bilingual">
                <div class="zh">© 2025 czz的线性代数代码世界</div>
                <div class="en">© 2025 czz's Linear Algebra Code World</div>
            </div>
            <p class="text-gray-400 bilingual">
                <span class="zh">数学与未来相遇的地方</span>
                <span class="en">Where mathematics meets the future</span>
            </p>
        </div>
    </footer>
    
    <script>
        // Matrix operations utility
        const MatrixOperations = {
            // Parse matrix from string input
            parseMatrix(input) {
                if (!input.trim()) {
                    throw new Error('Matrix input is empty');
                }
                
                const rows = input.trim().split('\n');
                const matrix = [];
                
                for (let i = 0; i < rows.length; i++) {
                    const row = rows[i].trim().split(/\s+/);
                    
                    if (row.length === 0 || (row.length === 1 && row[0] === '')) {
                        continue; // Skip empty rows
                    }
                    
                    const numRow = [];
                    for (let j = 0; j < row.length; j++) {
                        const num = parseFloat(row[j]);
                        if (isNaN(num)) {
                            throw new Error(`Invalid number at row ${i+1}, column ${j+1}: "${row[j]}"`);
                        }
                        numRow.push(num);
                    }
                    
                    matrix.push(numRow);
                }
                
                if (matrix.length === 0) {
                    throw new Error('Matrix has no valid rows');
                }
                
                return matrix;
            },
            
            // Check if matrix is valid (all rows have same length)
            isValidMatrix(matrix) {
                if (matrix.length === 0) return false;
                
                const cols = matrix[0].length;
                for (let i = 1; i < matrix.length; i++) {
                    if (matrix[i].length !== cols) {
                        return false;
                    }
                }
                
                return true;
            },
            
            // Check if matrix is symmetric
            isSymmetric(matrix) {
                const n = matrix.length;
                if (n === 0 || matrix[0].length !== n) return false; // Must be square
                
                for (let i = 0; i < n; i++) {
                    for (let j = i + 1; j < n; j++) {
                        if (Math.abs(matrix[i][j] - matrix[j][i]) > 1e-10) {
                            return false;
                        }
                    }
                }
                return true;
            },
            
            // Matrix transpose
            transpose(matrix) {
                const rows = matrix.length;
                const cols = matrix[0].length;
                const result = [];
                
                for (let j = 0; j < cols; j++) {
                    result[j] = [];
                    for (let i = 0; i < rows; i++) {
                        result[j][i] = matrix[i][j];
                    }
                }
                
                return result;
            },
            
            // Matrix multiplication
            multiply(A, B) {
                const m = A.length;
                const n = A[0].length;
                const p = B[0].length;
                
                const result = [];
                for (let i = 0; i < m; i++) {
                    result[i] = [];
                    for (let j = 0; j < p; j++) {
                        result[i][j] = 0;
                        for (let k = 0; k < n; k++) {
                            result[i][j] += A[i][k] * B[k][j];
                        }
                    }
                }
                
                return result;
            },
            
            // Create identity matrix
            identity(n) {
                const result = [];
                for (let i = 0; i < n; i++) {
                    result[i] = [];
                    for (let j = 0; j < n; j++) {
                        result[i][j] = (i === j) ? 1 : 0;
                    }
                }
                return result;
            },
            
            // Create diagonal matrix from coefficients
            diagonal(coeffs) {
                const n = coeffs.length;
                const result = this.identity(n);
                for (let i = 0; i < n; i++) {
                    result[i][i] = coeffs[i];
                }
                return result;
            },
            
            // Format matrix for display with proper brackets
            formatMatrix(matrix) {
                if (!matrix || matrix.length === 0) return '';
                
                const container = document.createElement('div');
                container.className = 'matrix-display';
                
                const bracketLeft = document.createElement('div');
                bracketLeft.className = 'matrix-bracket';
                bracketLeft.textContent = '[';
                container.appendChild(bracketLeft);
                
                const matrixContent = document.createElement('div');
                
                for (let i = 0; i < matrix.length; i++) {
                    const rowDiv = document.createElement('div');
                    rowDiv.className = 'matrix-row';
                    
                    for (let j = 0; j < matrix[i].length; j++) {
                        const cell = document.createElement('div');
                        cell.className = 'matrix-cell';
                        cell.textContent = matrix[i][j].toFixed(6);
                        rowDiv.appendChild(cell);
                    }
                    
                    matrixContent.appendChild(rowDiv);
                }
                
                container.appendChild(matrixContent);
                
                const bracketRight = document.createElement('div');
                bracketRight.className = 'matrix-bracket';
                bracketRight.textContent = ']';
                container.appendChild(bracketRight);
                
                return container;
            },
            
            // Format augmented matrix for display
            formatAugmentedMatrix(matrix, n) {
                if (!matrix || matrix.length === 0) return '';
                
                const container = document.createElement('div');
                container.className = 'matrix-display';
                
                const bracketLeft = document.createElement('div');
                bracketLeft.className = 'matrix-bracket';
                bracketLeft.textContent = '[';
                container.appendChild(bracketLeft);
                
                const matrixContent = document.createElement('div');
                
                for (let i = 0; i < matrix.length; i++) {
                    const rowDiv = document.createElement('div');
                    rowDiv.className = 'matrix-row';
                    
                    for (let j = 0; j < matrix[i].length; j++) {
                        const cell = document.createElement('div');
                        cell.className = 'matrix-cell';
                        cell.textContent = matrix[i][j].toFixed(6);
                        
                        // Add separator between A and I parts
                        if (j === n - 1) {
                            cell.style.borderRight = '2px solid rgba(255, 165, 0, 0.5)';
                            cell.style.paddingRight = '15px';
                        }
                        
                        rowDiv.appendChild(cell);
                    }
                    
                    matrixContent.appendChild(rowDiv);
                }
                
                container.appendChild(matrixContent);
                
                const bracketRight = document.createElement('div');
                bracketRight.className = 'matrix-bracket';
                bracketRight.textContent = ']';
                container.appendChild(bracketRight);
                
                return container;
            },
            
            // Format matrix as text for download
            formatMatrixText(matrix) {
                if (!matrix || matrix.length === 0) return '';
                
                let result = '';
                for (let i = 0; i < matrix.length; i++) {
                    result += matrix[i].map(x => x.toFixed(8)).join('\t');
                    if (i < matrix.length - 1) result += '\n';
                }
                
                return result;
            },
            
            // Calculate determinant (for verification)
            determinant(matrix) {
                const n = matrix.length;
                if (n === 1) return matrix[0][0];
                if (n === 2) return matrix[0][0] * matrix[1][1] - matrix[0][1] * matrix[1][0];
                
                let det = 0;
                for (let i = 0; i < n; i++) {
                    const minor = [];
                    for (let j = 1; j < n; j++) {
                        minor.push(matrix[j].filter((_, idx) => idx !== i));
                    }
                    det += matrix[0][i] * Math.pow(-1, i) * this.determinant(minor);
                }
                return det;
            }
        };
        
        // Utility functions
        const Utils = {
            // Show notification
            showNotification(message, type = 'info') {
                // Create notification element
                const notification = document.createElement('div');
                notification.className = `fixed top-20 right-6 p-4 rounded-lg z-50 ${
                    type === 'error' ? 'bg-red-500' : 
                    type === 'success' ? 'bg-green-500' : 'bg-blue-500'
                } text-white shadow-lg`;
                notification.textContent = message;
                
                // Add to page
                document.body.appendChild(notification);
                
                // Animate in
                anime({
                    targets: notification,
                    translateX: [100, 0],
                    opacity: [0, 1],
                    duration: 500,
                    easing: 'easeOutQuad'
                });
                
                // Remove after delay
                setTimeout(() => {
                    anime({
                        targets: notification,
                        translateX: [0, 100],
                        opacity: [1, 0],
                        duration: 500,
                        easing: 'easeInQuad',
                        complete: () => {
                            document.body.removeChild(notification);
                        }
                    });
                }, 3000);
            }
        };
        
        let calculationProcess = [];
        
        // Initialize page
        document.addEventListener('DOMContentLoaded', () => {
            createParticles();
            initializePage();
            bindEvents();
        });
        
        function createParticles() {
            const particleContainer = document.getElementById('particles');
            const particleCount = 20;
            
            for (let i = 0; i < particleCount; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = Math.random() * 100 + '%';
                particle.style.animationDelay = Math.random() * 6 + 's';
                particle.style.animationDuration = (Math.random() * 4 + 4) + 's';
                
                const colors = ['#00CCFF', '#00FFC6', '#6C00FF'];
                particle.style.background = colors[Math.floor(Math.random() * colors.length)];
                
                particleContainer.appendChild(particle);
            }
        }
        
        function initializePage() {
            // Animate page elements
            anime.timeline()
                .add({
                    targets: 'h1',
                    translateY: [50, 0],
                    opacity: [0, 1],
                    duration: 800,
                    easing: 'easeOutQuad'
                })
                .add({
                    targets: '.code-container, .input-container',
                    translateY: [30, 0],
                    opacity: [0, 1],
                    duration: 600,
                    delay: anime.stagger(200),
                    easing: 'easeOutQuad'
                }, '-=400');
        }
        
        function bindEvents() {
            const calculateBtn = document.getElementById('calculateBtn');
            const continueBtn = document.getElementById('continueBtn');
            const directoryBtn = document.getElementById('directoryBtn');
            const processBtn = document.getElementById('processBtn');
            const downloadBtn = document.getElementById('downloadBtn');
            
            calculateBtn.addEventListener('click', calculateStandardForm);
            continueBtn.addEventListener('click', clearInputs);
            directoryBtn.addEventListener('click', () => window.location.href = 'directory.html');
            processBtn.addEventListener('click', showProcess);
            downloadBtn.addEventListener('click', downloadProcess);
            
            // Real-time validation
            document.getElementById('matrixInput').addEventListener('input', validateMatrix);
        }
        
        function validateMatrix() {
            const input = document.getElementById('matrixInput');
            const errorDiv = document.getElementById('matrix-error');
            
            try {
                if (input.value.trim()) {
                    const matrix = MatrixOperations.parseMatrix(input.value);
                    if (!MatrixOperations.isValidMatrix(matrix)) {
                        throw new Error('Invalid matrix format');
                    }
                    if (!MatrixOperations.isSymmetric(matrix)) {
                        throw new Error('Matrix must be symmetric');
                    }
                }
                input.classList.remove('error');
                errorDiv.classList.add('hidden');
                return true;
            } catch (error) {
                input.classList.add('error');
                errorDiv.textContent = error.message;
                errorDiv.classList.remove('hidden');
                return false;
            }
        }
        
        function calculateStandardForm() {
            const matrixInput = document.getElementById('matrixInput');
            
            if (!validateMatrix()) {
                Utils.showNotification('Please fix matrix format errors', 'error');
                return;
            }
            
            if (!matrixInput.value.trim()) {
                Utils.showNotification('Please enter a matrix', 'error');
                return;
            }
            
            try {
                const matrix = MatrixOperations.parseMatrix(matrixInput.value);
                
                // Clear previous errors
                matrixInput.classList.remove('error');
                document.getElementById('matrix-error').classList.add('hidden');
                
                // Perform calculation with process tracking
                calculationProcess = [];
                const result = performAugmentedMatrixMethod(matrix);
                
                // Display result
                displayResult(result);
                
                // Show success notification
                Utils.showNotification('Standard form calculation completed successfully!', 'success');
                
            } catch (error) {
                Utils.showNotification(error.message, 'error');
            }
        }
        
        function performAugmentedMatrixMethod(matrix) {
            const n = matrix.length;
            
            // Build augmented matrix [A | I]
            const aug = [];
            for (let i = 0; i < n; i++) {
                aug[i] = [];
                for (let j = 0; j < n; j++) {
                    aug[i][j] = matrix[i][j];
                }
                for (let j = n; j < 2*n; j++) {
                    aug[i][j] = (j === n + i) ? 1 : 0;
                }
            }
            
            calculationProcess.push({
                type: 'info',
                content: {
                    zh: `输入对称矩阵 A (${n}×${n}):`,
                    en: `Input Symmetric Matrix A (${n}×${n}):`
                }
            });
            
            calculationProcess.push({
                type: 'matrix',
                matrix: matrix,
                description: {
                    zh: '原始矩阵:',
                    en: 'Original matrix:'
                }
            });
            
            calculationProcess.push({
                type: 'info',
                content: {
                    zh: '构建增广矩阵 [A | I]:',
                    en: 'Building augmented matrix [A | I]:'
                }
            });
            
            calculationProcess.push({
                type: 'augmented',
                matrix: aug,
                n: n,
                description: {
                    zh: '初始增广矩阵:',
                    en: 'Initial augmented matrix:'
                }
            });
            
            calculationProcess.push({
                type: 'info',
                content: {
                    zh: '开始合同变换过程...',
                    en: 'Starting congruence transformation process...'
                }
            });
            
            let step = 0;
            
            for (let i = 0; i < n; i++) {
                // Find pivot
                let pivot = i;
                for (let j = i + 1; j < n; j++) {
                    if (Math.abs(aug[j][j]) > Math.abs(aug[pivot][pivot])) {
                        pivot = j;
                    }
                }
                
                if (Math.abs(aug[pivot][pivot]) < 1e-10) {
                    // Handle zero diagonal element
                    let found = false;
                    for (let j = i + 1; j < n && !found; j++) {
                        if (Math.abs(aug[i][j]) > 1e-10) {
                            // Create transformation matrix to create square term
                            const T = MatrixOperations.identity(n);
                            T[i][i] = 1;
                            T[i][j] = 1;
                            T[j][i] = 1;
                            T[j][j] = -1;
                            
                            step++;
                            
                            calculationProcess.push({
                                type: 'info',
                                content: {
                                    zh: `步骤 ${step}: 处理零对角元，创造平方项`,
                                    en: `Step ${step}: Handling zero diagonal element, creating square term`
                                }
                            });
                            
                            calculationProcess.push({
                                type: 'matrix',
                                matrix: T,
                                description: {
                                    zh: `创造平方项矩阵 T${step}:`,
                                    en: `Square term creation matrix T${step}:`
                                }
                            });
                            
                            // Apply congruence transformation to the entire augmented matrix
                            const TT = MatrixOperations.transpose(T);
                            const tempA = [];
                            const tempI = [];
                            
                            for (let r = 0; r < n; r++) {
                                tempA[r] = [];
                                tempI[r] = [];
                                for (let c = 0; c < n; c++) {
                                    tempA[r][c] = aug[r][c];
                                    tempI[r][c] = aug[r][n + c];
                                }
                            }
                            
                            const transformedA = MatrixOperations.multiply(MatrixOperations.multiply(TT, tempA), T);
                            const transformedI = MatrixOperations.multiply(tempI, T);
                            
                            for (let r = 0; r < n; r++) {
                                for (let c = 0; c < n; c++) {
                                    aug[r][c] = transformedA[r][c];
                                    aug[r][n + c] = transformedI[r][c];
                                }
                            }
                            
                            calculationProcess.push({
                                type: 'augmented',
                                matrix: aug,
                                n: n,
                                description: {
                                    zh: `应用变换后的增广矩阵:`,
                                    en: `Augmented matrix after transformation:`
                                }
                            });
                            
                            found = true;
                            i--; // Reprocess this row
                            break;
                        }
                    }
                    
                    if (!found) {
                        calculationProcess.push({
                            type: 'info',
                            content: {
                                zh: `位置(${i+1},${i+1})及其相关元素全为0，跳过`,
                                en: `Position (${i+1},${i+1}) and related elements are all zero, skipping`
                            }
                        });
                    }
                } else {
                    if (pivot !== i) {
                        // Row and column exchange
                        [aug[i], aug[pivot]] = [aug[pivot], aug[i]];
                        for (let j = 0; j < n; j++) {
                            [aug[j][i], aug[j][pivot]] = [aug[j][pivot], aug[j][i]];
                            [aug[j][n + i], aug[j][n + pivot]] = [aug[j][n + pivot], aug[j][n + i]];
                        }
                        
                        step++;
                        
                        calculationProcess.push({
                            type: 'info',
                            content: {
                                zh: `步骤 ${step}: 交换行 ${i+1} ↔ 行 ${pivot+1} 和列 ${i+1} ↔ 列 ${pivot+1}`,
                                en: `Step ${step}: Swapping row ${i+1} ↔ row ${pivot+1} and column ${i+1} ↔ column ${pivot+1}`
                            }
                        });
                        
                        calculationProcess.push({
                            type: 'augmented',
                            matrix: aug,
                            n: n,
                            description: {
                                zh: `交换后的增广矩阵:`,
                                en: `Augmented matrix after swapping:`
                            }
                        });
                    }
                    
                    // Eliminate other rows' corresponding elements
                    for (let j = 0; j < n; j++) {
                        if (j !== i && Math.abs(aug[j][i]) > 1e-10) {
                            const factor = aug[j][i] / aug[i][i];
                            
                            // Row elimination
                            for (let k = i; k < 2 * n; k++) {
                                aug[j][k] -= factor * aug[i][k];
                            }
                            
                            // Column elimination (maintain symmetry)
                            for (let k = 0; k < n; k++) {
                                aug[k][j] -= factor * aug[k][i];
                            }
                        }
                    }
                    
                    step++;
                    
                    calculationProcess.push({
                        type: 'info',
                        content: {
                            zh: `步骤 ${step}: 第 ${i+1} 步消元`,
                            en: `Step ${step}: Elimination step ${i+1}`
                        }
                    });
                    
                    calculationProcess.push({
                        type: 'augmented',
                        matrix: aug,
                        n: n,
                        description: {
                            zh: `消元后的增广矩阵:`,
                            en: `Augmented matrix after elimination:`
                        }
                    });
                }
            }
            
            // Extract results
            const coefficients = [];
            let B = [];
            
            for (let i = 0; i < n; i++) {
                coefficients.push(aug[i][i]);
                B[i] = [];
                for (let j = 0; j < n; j++) {
                    B[i][j] = aug[i][n + j];
                }
            }

            B = MatrixOperations.transpose(B);
            
            calculationProcess.push({
                type: 'info',
                content: {
                    zh: '变换完成，提取标准型系数和变换矩阵:',
                    en: 'Transformation complete, extracting standard form coefficients and transformation matrix:'
                }
            });
            
            return {
                standardMatrix: aug.map(row => row.slice(0, n)),
                transformationMatrix: B,
                coefficients: coefficients,
                augmentedMatrix: aug,
                originalMatrix: matrix
            };
        }
        
        function displayResult(result) {
            const resultsSection = document.getElementById('resultsSection');
            const standardForm = document.getElementById('standardForm');
            const augmentedMatrix = document.getElementById('augmentedMatrix');
            const transformMatrix = document.getElementById('transformMatrix');
            const verificationResults = document.getElementById('verificationResults');
            const errorAnalysis = document.getElementById('errorAnalysis');
            
            // Format standard form
            let formText = 'f = ';
            let first = true;
            
            for (let i = 0; i < result.coefficients.length; i++) {
                if (Math.abs(result.coefficients[i]) > 1e-10 || !first) {
                    if (!first) formText += ' + ';
                    formText += result.coefficients[i].toFixed(6) + ' * y' + (i + 1) + '²';
                    first = false;
                }
            }
            
            standardForm.textContent = formText;
            
            // Clear previous results
            augmentedMatrix.innerHTML = '';
            transformMatrix.innerHTML = '';
            verificationResults.innerHTML = '';
            errorAnalysis.innerHTML = '';
            
            // Add augmented matrix
            const augElement = MatrixOperations.formatAugmentedMatrix(result.augmentedMatrix, result.coefficients.length);
            augmentedMatrix.appendChild(augElement);
            
            // Add transformation matrix
            const matrixElement = MatrixOperations.formatMatrix(result.transformationMatrix);
            transformMatrix.appendChild(matrixElement);
            
            // Perform verification
            const verification = performVerification(result);
            displayVerification(verificationResults, verification);
            displayErrorAnalysis(errorAnalysis, verification);
            
            resultsSection.classList.remove('hidden');
            
            // Animate result appearance
            anime({
                targets: resultsSection,
                opacity: [0, 1],
                translateY: [30, 0],
                duration: 600,
                easing: 'easeOutQuad'
            });
        }
        
        function performVerification(result) {
            const n = result.originalMatrix.length;
            
            // Verify C^T * A * C = diagonal matrix
            const CT = MatrixOperations.transpose(result.transformationMatrix);
            const temp1 = MatrixOperations.multiply(CT, result.originalMatrix);
            const verificationMatrix = MatrixOperations.multiply(temp1, result.transformationMatrix);
            
            // Create theoretical diagonal matrix
            const theoreticalMatrix = MatrixOperations.diagonal(result.coefficients);
            
            // Calculate error
            let maxError = 0;
            let totalError = 0;
            
            for (let i = 0; i < n; i++) {
                for (let j = 0; j < n; j++) {
                    const error = Math.abs(verificationMatrix[i][j] - theoreticalMatrix[i][j]);
                    if (error > maxError) maxError = error;
                    totalError += error * error;
                }
            }
            
            const rmsError = Math.sqrt(totalError / (n * n));
            
            // Check if transformation matrix is invertible
            const detB = MatrixOperations.determinant(result.transformationMatrix);
            
            return {
                verificationMatrix: verificationMatrix,
                theoreticalMatrix: theoreticalMatrix,
                maxError: maxError,
                rmsError: rmsError,
                detB: detB,
                isAccurate: maxError < 1e-8,
                isInvertible: Math.abs(detB) > 1e-10
            };
        }
        
        function displayVerification(container, verification) {
            container.innerHTML = '';
            
            // Verification matrix
            const verDiv = document.createElement('div');
            verDiv.className = 'mb-4';
            verDiv.innerHTML = '<div class="bilingual"><div class="zh font-semibold">验证矩阵 CᵀAC:</div><div class="en font-semibold">Verification Matrix CᵀAC:</div></div>';
            verDiv.appendChild(MatrixOperations.formatMatrix(verification.verificationMatrix));
            container.appendChild(verDiv);
            
            // Theoretical matrix
            const theoryDiv = document.createElement('div');
            theoryDiv.className = 'mb-4';
            theoryDiv.innerHTML = '<div class="bilingual"><div class="zh font-semibold">理论标准型矩阵:</div><div class="en font-semibold">Theoretical Standard Form Matrix:</div></div>';
            theoryDiv.appendChild(MatrixOperations.formatMatrix(verification.theoreticalMatrix));
            container.appendChild(theoryDiv);
            
            // Determinant information
            const detDiv = document.createElement('div');
            detDiv.className = 'mb-4 bilingual';
            detDiv.innerHTML = `
                <div class="zh">变换矩阵 C 的行列式: ${verification.detB.toFixed(8)} ${verification.isInvertible ? '(可逆)' : '(不可逆!)'}</div>
                <div class="en">Transformation matrix C determinant: ${verification.detB.toFixed(8)} ${verification.isInvertible ? '(invertible)' : '(not invertible!)'}</div>
            `;
            container.appendChild(detDiv);
            
            // Success/failure message
            const statusDiv = document.createElement('div');
            statusDiv.className = 'bilingual text-lg font-bold';
            
            if (verification.isAccurate) {
                statusDiv.innerHTML = '<div class="zh text-green-400">✓ 验证成功：变换结果非常接近理论值</div><div class="en text-green-400">✓ Verification successful: Transformation result is very close to theoretical values</div>';
            } else {
                statusDiv.innerHTML = '<div class="zh text-red-400">✗ 验证失败：变换结果与理论值有较大差异</div><div class="en text-red-400">✗ Verification failed: Transformation result has significant difference from theoretical values</div>';
            }
            
            container.appendChild(statusDiv);
        }
        
        function displayErrorAnalysis(container, verification) {
            container.innerHTML = '';
            
            const errorDiv = document.createElement('div');
            errorDiv.className = 'bilingual';
            errorDiv.innerHTML = `
                <div class="zh">最大绝对误差: ${verification.maxError.toExponential(6)}</div>
                <div class="en">Maximum absolute error: ${verification.maxError.toExponential(6)}</div>
                <div class="zh">均方根误差: ${verification.rmsError.toExponential(6)}</div>
                <div class="en">Root mean square error: ${verification.rmsError.toExponential(6)}</div>
            `;
            
            container.appendChild(errorDiv);
        }
        
        function clearInputs() {
            document.getElementById('matrixInput').value = '';
            document.getElementById('resultsSection').classList.add('hidden');
            document.getElementById('processSection').classList.add('hidden');
            calculationProcess = [];
        }
        
        function showProcess() {
            const processSection = document.getElementById('processSection');
            const processSteps = document.getElementById('processSteps');
            
            processSteps.innerHTML = '';
            
            calculationProcess.forEach((step, index) => {
                const stepDiv = document.createElement('div');
                stepDiv.className = 'calculation-step';
                
                if (step.type === 'info') {
                    const infoDiv = document.createElement('div');
                    infoDiv.className = 'bilingual';
                    
                    const zhDiv = document.createElement('div');
                    zhDiv.className = 'zh';
                    zhDiv.textContent = step.content.zh;
                    
                    const enDiv = document.createElement('div');
                    enDiv.className = 'en';
                    enDiv.textContent = step.content.en;
                    
                    infoDiv.appendChild(zhDiv);
                    infoDiv.appendChild(enDiv);
                    stepDiv.appendChild(infoDiv);
                } 
                else if (step.type === 'matrix') {
                    if (step.description) {
                        const descDiv = document.createElement('div');
                        descDiv.className = 'bilingual mb-2';
                        
                        const zhDiv = document.createElement('div');
                        zhDiv.className = 'zh font-semibold';
                        zhDiv.textContent = step.description.zh;
                        
                        const enDiv = document.createElement('div');
                        enDiv.className = 'en font-semibold';
                        enDiv.textContent = step.description.en;
                        
                        descDiv.appendChild(zhDiv);
                        descDiv.appendChild(enDiv);
                        stepDiv.appendChild(descDiv);
                    }
                    
                    const matrixDiv = document.createElement('div');
                    matrixDiv.appendChild(MatrixOperations.formatMatrix(step.matrix));
                    stepDiv.appendChild(matrixDiv);
                }
                else if (step.type === 'augmented') {
                    if (step.description) {
                        const descDiv = document.createElement('div');
                        descDiv.className = 'bilingual mb-2';
                        
                        const zhDiv = document.createElement('div');
                        zhDiv.className = 'zh font-semibold';
                        zhDiv.textContent = step.description.zh;
                        
                        const enDiv = document.createElement('div');
                        enDiv.className = 'en font-semibold';
                        enDiv.textContent = step.description.en;
                        
                        descDiv.appendChild(zhDiv);
                        descDiv.appendChild(enDiv);
                        stepDiv.appendChild(descDiv);
                    }
                    
                    const matrixDiv = document.createElement('div');
                    matrixDiv.appendChild(MatrixOperations.formatAugmentedMatrix(step.matrix, step.n));
                    stepDiv.appendChild(matrixDiv);
                }
                
                processSteps.appendChild(stepDiv);
            });
            
            processSection.classList.remove('hidden');
            
            // Animate process appearance
            anime({
                targets: processSection,
                opacity: [0, 1],
                translateY: [30, 0],
                duration: 600,
                easing: 'easeOutQuad'
            });
        }
        
        function downloadProcess() {
            let content = 'Quadratic Form Standard Form - Calculation Process\n';
            content += '================================================\n\n';
            
            calculationProcess.forEach(step => {
                if (step.type === 'info') {
                    content += step.content.en + '\n';
                } 
                else if (step.type === 'matrix') {
                    if (step.description) {
                        content += step.description.en + '\n';
                    }
                    content += MatrixOperations.formatMatrixText(step.matrix) + '\n\n';
                }
                else if (step.type === 'augmented') {
                    if (step.description) {
                        content += step.description.en + '\n';
                    }
                    content += MatrixOperations.formatMatrixText(step.matrix) + '\n\n';
                }
            });
            
            const blob = new Blob([content], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = 'QuadraticForm_Standard_Calculation_Process.txt';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            Utils.showNotification('Calculation process downloaded successfully!', 'success');
        }
    </script>
</body>
</html>